<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘åŠ å¯†å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .step {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }
        
        .step-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .step-number {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-upload label {
            display: block;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload label:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .file-info {
            margin-top: 10px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        input[type="password"] {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        input[type="password"]:focus {
            border-color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.25);
        }
        
        input[type="password"]::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            margin: 10px 5px;
        }
        
        button:hover, button:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
        }
        
        .encrypt-btn {
            background: linear-gradient(90deg, #38ef7d, #11998e);
        }
        
        .download-btn {
            background: linear-gradient(90deg, #2193b0, #6dd5ed);
        }
        
        .preview-btn {
            background: linear-gradient(90deg, #fc4a1a, #f7b733);
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00b09b, #96c93d);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        .result-container {
            margin-top: 30px;
            display: none;
        }
        
        .preview-container {
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            height: 500px;
            display: none;
        }
        
        .preview-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .error {
            color: #ff6b6b;
            margin-top: 10px;
            display: none;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .success {
            color: #4caf50;
            margin-top: 10px;
            display: none;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .instructions {
            margin-top: 20px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è§†é¢‘åŠ å¯†å·¥å…·</h1>
        
        <div class="step">
            <div class="step-title">
                <span class="step-number">1</span>
                <span>é€‰æ‹©è§†é¢‘æ–‡ä»¶</span>
            </div>
            <div class="file-upload">
                <input type="file" id="videoFile" accept="video/*">
                <label for="videoFile">ç‚¹å‡»é€‰æ‹©è§†é¢‘æ–‡ä»¶æˆ–æ‹–æ”¾åˆ°æ­¤å¤„</label>
            </div>
            <div class="file-info" id="fileInfo">æœªé€‰æ‹©æ–‡ä»¶</div>
        </div>
        
        <div class="step">
            <div class="step-title">
                <span class="step-number">2</span>
                <span>è®¾ç½®å¯†ç </span>
            </div>
            <input type="password" id="password" placeholder="è¯·è¾“å…¥åŠ å¯†å¯†ç ...">
            <div class="error" id="passwordError">å¯†ç ä¸èƒ½ä¸ºç©º</div>
        </div>
        
        <div class="step">
            <div class="step-title">
                <span class="step-number">3</span>
                <span>åŠ å¯†è§†é¢‘</span>
            </div>
            <button id="encryptBtn" class="encrypt-btn" disabled>å¼€å§‹åŠ å¯†</button>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText">å‡†å¤‡ä¸­...</div>
            </div>
            <div class="error" id="encryptError"></div>
            <div class="success" id="encryptSuccess"></div>
        </div>
        
        <div class="result-container" id="resultContainer">
            <div class="step-title">
                <span class="step-number">4</span>
                <span>å¤„ç†ç»“æœ</span>
            </div>
            <div class="actions">
                <button id="downloadBtn" class="download-btn">ä¸‹è½½åŠ å¯†è§†é¢‘é¡µé¢</button>
                <button id="previewBtn" class="preview-btn">é¢„è§ˆåŠ å¯†è§†é¢‘é¡µé¢</button>
            </div>
            <div class="preview-container" id="previewContainer">
                <iframe id="previewFrame"></iframe>
            </div>
        </div>
        
        <div class="instructions">
            <p>ğŸ“Œ ä½¿ç”¨è¯´æ˜ï¼š</p>
            <p>1. é€‰æ‹©è¦åŠ å¯†çš„è§†é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒå¸¸è§è§†é¢‘æ ¼å¼ï¼‰</p>
            <p>2. è®¾ç½®ä¸€ä¸ªå¯†ç ï¼Œç”¨äºåŠ å¯†è§†é¢‘å’Œåç»­éªŒè¯</p>
            <p>3. ç‚¹å‡»"å¼€å§‹åŠ å¯†"æŒ‰é’®ï¼Œç­‰å¾…å¤„ç†å®Œæˆ</p>
            <p>4. ä¸‹è½½ç”Ÿæˆçš„HTMLæ–‡ä»¶æˆ–é¢„è§ˆæ•ˆæœ</p>
            <p>5. æ‰“å¼€ç”Ÿæˆçš„HTMLæ–‡ä»¶ï¼Œè¾“å…¥å¯†ç å³å¯è§‚çœ‹è§†é¢‘</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let selectedFile = null;
        let encryptedHtmlContent = null;
        
        // DOMå…ƒç´ 
        const videoFileInput = document.getElementById('videoFile');
        const fileInfo = document.getElementById('fileInfo');
        const passwordInput = document.getElementById('password');
        const encryptBtn = document.getElementById('encryptBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const passwordError = document.getElementById('passwordError');
        const encryptError = document.getElementById('encryptError');
        const encryptSuccess = document.getElementById('encryptSuccess');
        const resultContainer = document.getElementById('resultContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        const previewBtn = document.getElementById('previewBtn');
        const previewContainer = document.getElementById('previewContainer');
        const previewFrame = document.getElementById('previewFrame');
        
        // äº‹ä»¶ç›‘å¬
        videoFileInput.addEventListener('change', handleFileSelect);
        passwordInput.addEventListener('input', handlePasswordInput);
        encryptBtn.addEventListener('click', encryptVideo);
        downloadBtn.addEventListener('click', downloadEncryptedHtml);
        previewBtn.addEventListener('click', previewEncryptedHtml);
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                fileInfo.textContent = 'å·²é€‰æ‹©: ' + file.name + ' (' + fileSizeMB + ' MB)';
                checkReadyToEncrypt();
            } else {
                selectedFile = null;
                fileInfo.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                encryptBtn.disabled = true;
            }
        }
        
        // å¤„ç†å¯†ç è¾“å…¥
        function handlePasswordInput() {
            passwordError.style.display = 'none';
            checkReadyToEncrypt();
        }
        
        // æ£€æŸ¥æ˜¯å¦å¯ä»¥å¼€å§‹åŠ å¯†
        function checkReadyToEncrypt() {
            if (selectedFile && passwordInput.value.trim()) {
                encryptBtn.disabled = false;
            } else {
                encryptBtn.disabled = true;
            }
        }
        
        // XORåŠ å¯†å‡½æ•°
        function xorEncrypt(data, key) {
            const keyBytes = new TextEncoder().encode(key);
            const result = new Uint8Array(data.length);
            
            for (let i = 0; i < data.length; i++) {
                result[i] = data[i] ^ keyBytes[i % keyBytes.length];
            }
            
            return result;
        }
        
        // ç”Ÿæˆå¯†ç æ ¡éªŒå’Œ
        function simpleChecksum(password) {
            let checksum = 0;
            for (let i = 0; i < password.length; i++) {
                checksum = (checksum + password.charCodeAt(i)) % 10000;
            }
            return checksum.toString().padStart(4, '0');
        }
        
        // å°†ArrayBufferè½¬æ¢ä¸ºBase64
        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            const len = bytes.byteLength;
            
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            
            return btoa(binary);
        }
        
        // åŠ å¯†è§†é¢‘
        async function encryptVideo() {
            const password = passwordInput.value.trim();
            
            if (!password) {
                passwordError.style.display = 'block';
                return;
            }
            
            // é‡ç½®çŠ¶æ€
            encryptError.style.display = 'none';
            encryptSuccess.style.display = 'none';
            resultContainer.style.display = 'none';
            previewContainer.style.display = 'none';
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = 'è¯»å–è§†é¢‘æ–‡ä»¶...';
            
            try {
                // è¯»å–æ–‡ä»¶
                const fileReader = new FileReader();
                
                fileReader.onload = async function(e) {
                    const videoData = new Uint8Array(e.target.result);
                    
                    // æ›´æ–°è¿›åº¦
                    progressBar.style.width = '30%';
                    progressText.textContent = 'åŠ å¯†è§†é¢‘æ•°æ®...';
                    
                    // ä½¿ç”¨setTimeouté¿å…UIé˜»å¡
                    setTimeout(() => {
                        // åŠ å¯†è§†é¢‘æ•°æ®
                        const encryptedVideo = xorEncrypt(videoData, password);
                        
                        // æ›´æ–°è¿›åº¦
                        progressBar.style.width = '60%';
                        progressText.textContent = 'è½¬æ¢ä¸ºBase64...';
                        
                        // è½¬æ¢ä¸ºBase64
                        const videoB64 = arrayBufferToBase64(encryptedVideo);
                        
                        // æ›´æ–°è¿›åº¦
                        progressBar.style.width = '80%';
                        progressText.textContent = 'ç”ŸæˆHTMLé¡µé¢...';
                        
                        // ç”Ÿæˆå¯†ç æ ¡éªŒå’Œ
                        const passwordChecksum = simpleChecksum(password);
                        
                        // è·å–æ–‡ä»¶ä¿¡æ¯
                        const videoName = selectedFile.name;
                        const fileSize = encryptedVideo.length;
                        
                        // ç”ŸæˆHTMLå†…å®¹
                        encryptedHtmlContent = generateHtml(videoB64, passwordChecksum, videoName, fileSize);
                        
                        // æ›´æ–°è¿›åº¦
                        progressBar.style.width = '100%';
                        progressText.textContent = 'å®Œæˆï¼';
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        encryptSuccess.textContent = 'è§†é¢‘åŠ å¯†æˆåŠŸï¼';
                        encryptSuccess.style.display = 'block';
                        
                        // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                        resultContainer.style.display = 'block';
                        
                        // éšè—è¿›åº¦æ¡
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                        }, 1000);
                    }, 100);
                };
                
                fileReader.onerror = function() {
                    throw new Error('è¯»å–æ–‡ä»¶å¤±è´¥');
                };
                
                fileReader.readAsArrayBuffer(selectedFile);
                
            } catch (error) {
                encryptError.textContent = 'åŠ å¯†å¤±è´¥: ' + error.message;
                encryptError.style.display = 'block';
                progressContainer.style.display = 'none';
            }
        }
        
        // ç”ŸæˆHTMLå†…å®¹
        function generateHtml(videoB64, passwordChecksum, videoName, fileSize) {
            // ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥è€Œä¸æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œé¿å…åµŒå¥—é—®é¢˜
            var html = '<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n';
            html += '    <meta charset="UTF-8">\n';
            html += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
            html += '    <title>åŠ å¯†è§†é¢‘æ’­æ”¾å™¨</title>\n';
            html += '    <style>\n';
            html += '        body {\n';
            html += '            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n';
            html += '            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);\n';
            html += '            margin: 0;\n';
            html += '            padding: 20px;\n';
            html += '            min-height: 100vh;\n';
            html += '            display: flex;\n';
            html += '            flex-direction: column;\n';
            html += '            align-items: center;\n';
            html += '            justify-content: center;\n';
            html += '            color: white;\n';
            html += '        }\n';
            html += '        .container {\n';
            html += '            background: rgba(255, 255, 255, 0.1);\n';
            html += '            backdrop-filter: blur(10px);\n';
            html += '            border-radius: 20px;\n';
            html += '            padding: 40px;\n';
            html += '            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);\n';
            html += '            width: 85%;\n';
            html += '            max-width: 900px;\n';
            html += '            text-align: center;\n';
            html += '            display: none;\n';
            html += '        }\n';
            html += '        .loading-screen {\n';
            html += '            position: fixed;\n';
            html += '            top: 0;\n';
            html += '            left: 0;\n';
            html += '            width: 100%;\n';
            html += '            height: 100%;\n';
            html += '            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);\n';
            html += '            display: flex;\n';
            html += '            flex-direction: column;\n';
            html += '            align-items: center;\n';
            html += '            justify-content: center;\n';
            html += '            z-index: 1000;\n';
            html += '        }\n';
            html += '        .loading-logo {\n';
            html += '            font-size: 32px;\n';
            html += '            font-weight: bold;\n';
            html += '            margin-bottom: 30px;\n';
            html += '            display: flex;\n';
            html += '            align-items: center;\n';
            html += '            gap: 15px;\n';
            html += '        }\n';
            html += '        .loading-icon {\n';
            html += '            font-size: 40px;\n';
            html += '        }\n';
            html += '        .loading-progress-container {\n';
            html += '            width: 80%;\n';
            html += '            max-width: 400px;\n';
            html += '            background: rgba(255, 255, 255, 0.1);\n';
            html += '            border-radius: 10px;\n';
            html += '            margin: 20px 0;\n';
            html += '            overflow: hidden;\n';
            html += '        }\n';
            html += '        .loading-progress-bar {\n';
            html += '            width: 0%;\n';
            html += '            height: 20px;\n';
            html += '            background: linear-gradient(90deg, #00b09b, #96c93d);\n';
            html += '            border-radius: 10px;\n';
            html += '            transition: width 0.5s ease;\n';
            html += '        }\n';
            html += '        .loading-text {\n';
            html += '            font-size: 16px;\n';
            html += '            margin-top: 10px;\n';
            html += '            color: rgba(255, 255, 255, 0.9);\n';
            html += '        }\n';
            html += '        .loading-details {\n';
            html += '            font-size: 14px;\n';
            html += '            color: rgba(255, 255, 255, 0.7);\n';
            html += '            margin-top: 5px;\n';
            html += '        }\n';
            html += '        h1 {\n';
            html += '            margin-top: 0;\n';
            html += '            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n';
            html += '            font-size: 2.2rem;\n';
            html += '            margin-bottom: 10px;\n';
            html += '        }\n';
            html += '        .subtitle {\n';
            html += '            font-size: 1.1rem;\n';
            html += '            margin-bottom: 25px;\n';
            html += '            opacity: 0.9;\n';
            html += '        }\n';
            html += '        .password-form {\n';
            html += '            margin: 25px 0;\n';
            html += '            display: flex;\n';
            html += '            flex-direction: column;\n';
            html += '            align-items: center;\n';
            html += '            gap: 15px;\n';
            html += '        }\n';
            html += '        input[type="text"] {\n';
            html += '            padding: 12px 20px;\n';
            html += '            border: 2px solid rgba(255, 255, 255, 0.3);\n';
            html += '            border-radius: 50px;\n';
            html += '            background: rgba(255, 255, 255, 0.15);\n';
            html += '            color: white;\n';
            html += '            font-size: 16px;\n';
            html += '            width: 70%;\n';
            html += '            max-width: 350px;\n';
            html += '            outline: none;\n';
            html += '            transition: all 0.3s ease;\n';
            html += '        }\n';
            html += '        input[type="text"]:focus {\n';
            html += '            border-color: rgba(255, 255, 255, 0.7);\n';
            html += '            background: rgba(255, 255, 255, 0.25);\n';
            html += '        }\n';
            html += '        input[type="text"]::placeholder {\n';
            html += '            color: rgba(255, 255, 255, 0.7);\n';
            html += '        }\n';
            html += '        button {\n';
            html += '            padding: 12px 30px;\n';
            html += '            border: none;\n';
            html += '            border-radius: 50px;\n';
            html += '            background: linear-gradient(90deg, #ff416c, #ff4b2b);\n';
            html += '            color: white;\n';
            html += '            font-size: 16px;\n';
            html += '            font-weight: bold;\n';
            html += '            cursor: pointer;\n';
            html += '            transition: all 0.3s ease;\n';
            html += '            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n';
            html += '            margin: 5px;\n';
            html += '        }\n';
            html += '        button:hover, button:active {\n';
            html += '            transform: translateY(-2px);\n';
            html += '            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n';
            html += '        }\n';
            html += '        .download-btn {\n';
            html += '            background: linear-gradient(90deg, #2193b0, #6dd5ed);\n';
            html += '        }\n';
            html += '        .play-btn {\n';
            html += '            background: linear-gradient(90deg, #38ef7d, #11998e);\n';
            html += '        }\n';
            html += '        .video-container {\n';
            html += '            display: none;\n';
            html += '            margin-top: 25px;\n';
            html += '            width: 100%;\n';
            html += '            border-radius: 15px;\n';
            html += '            overflow: hidden;\n';
            html += '            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);\n';
            html += '        }\n';
            html += '        video {\n';
            html += '            width: 100%;\n';
            html += '            display: block;\n';
            html += '        }\n';
            html += '        .error {\n';
            html += '            color: #ff6b6b;\n';
            html += '            margin-top: 12px;\n';
            html += '            display: none;\n';
            html += '            font-weight: bold;\n';
            html += '            background: rgba(0, 0, 0, 0.3);\n';
            html += '            padding: 8px 16px;\n';
            html += '            border-radius: 8px;\n';
            html += '            font-size: 14px;\n';
            html += '        }\n';
            html += '        .processing-message {\n';
            html += '            display: none;\n';
            html += '            margin-top: 12px;\n';
            html += '            color: #fff;\n';
            html += '            font-size: 14px;\n';
            html += '        }\n';
            html += '        .action-buttons {\n';
            html += '            margin-top: 15px;\n';
            html += '            display: flex;\n';
            html += '            justify-content: center;\n';
            html += '            gap: 12px;\n';
            html += '            flex-wrap: wrap;\n';
            html += '        }\n';
            html += '        .instructions {\n';
            html += '            margin-top: 25px;\n';
            html += '            font-size: 14px;\n';
            html += '            color: rgba(255, 255, 255, 0.8);\n';
            html += '            line-height: 1.5;\n';
            html += '        }\n';
            html += '        .logo {\n';
            html += '            font-size: 24px;\n';
            html += '            font-weight: bold;\n';
            html += '            margin-bottom: 25px;\n';
            html += '            display: flex;\n';
            html += '            align-items: center;\n';
            html += '            gap: 12px;\n';
            html += '        }\n';
            html += '        .logo-icon {\n';
            html += '            font-size: 32px;\n';
            html += '        }\n';
            html += '        .footer {\n';
            html += '            margin-top: 35px;\n';
            html += '            font-size: 13px;\n';
            html += '            opacity: 0.7;\n';
            html += '        }\n';
            html += '        .mobile-warning {\n';
            html += '            display: none;\n';
            html += '            background: rgba(255, 193, 7, 0.2);\n';
            html += '            border-left: 4px solid #ffc107;\n';
            html += '            padding: 12px;\n';
            html += '            margin: 15px 0;\n';
            html += '            border-radius: 5px;\n';
            html += '            text-align: left;\n';
            html += '            font-size: 14px;\n';
            html += '        }\n';
            html += '        @media (max-width: 768px) {\n';
            html += '            .container {\n';
            html += '                padding: 20px;\n';
            html += '                width: 90%;\n';
            html += '            }\n';
            html += '            input[type="text"] {\n';
            html += '                width: 90%;\n';
            html += '                padding: 10px 18px;\n';
            html += '                font-size: 15px;\n';
            html += '            }\n';
            html += '            button {\n';
            html += '                padding: 10px 25px;\n';
            html += '                font-size: 15px;\n';
            html += '                width: 100%;\n';
            html += '            }\n';
            html += '            .action-buttons {\n';
            html += '                flex-direction: column;\n';
            html += '                align-items: center;\n';
            html += '            }\n';
            html += '            .mobile-warning {\n';
            html += '                display: block;\n';
            html += '            }\n';
            html += '            .loading-progress-container {\n';
            html += '                width: 90%;\n';
            html += '            }\n';
            html += '        }\n';
            html += '    </style>\n';
            html += '</head>\n<body>\n';
            html += '    <!-- åŠ è½½å±å¹• -->\n';
            html += '    <div class="loading-screen" id="loadingScreen">\n';
            html += '        <div class="loading-logo">\n';
            html += '            <span class="loading-icon">ğŸ”’</span>\n';
            html += '            <span>å®‰å…¨è§†é¢‘æ’­æ”¾ç³»ç»Ÿ</span>\n';
            html += '        </div>\n';
            html += '        <div class="loading-progress-container">\n';
            html += '            <div class="loading-progress-bar" id="loadingProgressBar"></div>\n';
            html += '        </div>\n';
            html += '        <div class="loading-text" id="loadingText">æ­£åœ¨åŠ è½½è§†é¢‘æ•°æ®...</div>\n';
            html += '        <div class="loading-details" id="loadingDetails">0% - å‡†å¤‡ä¸­</div>\n';
            html += '    </div>\n\n';
            html += '    <!-- ä¸»å†…å®¹å®¹å™¨ -->\n';
            html += '    <div class="container" id="mainContainer">\n';
            html += '        <div class="logo">\n';
            html += '            <span class="logo-icon">ğŸ”’</span>\n';
            html += '            <span>å®‰å…¨è§†é¢‘æ’­æ”¾ç³»ç»Ÿ</span>\n';
            html += '        </div>\n';
            html += '        \n';
            html += '        <h1>åŠ å¯†è§†é¢‘å†…å®¹</h1>\n';
            html += '        <div class="subtitle">è¯·è¾“å…¥å¯†ç è§£é”è§†é¢‘</div>\n';
            html += '        \n';
            html += '        <div class="mobile-warning">\n';
            html += '            <strong>ç§»åŠ¨è®¾å¤‡æç¤º:</strong> å¤§æ–‡ä»¶å¤„ç†éœ€è¦æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚\n';
            html += '        </div>\n';
            html += '        \n';
            html += '        <div class="password-form">\n';
            html += '            <input type="text" id="passwordInput" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ...">\n';
            html += '            <button id="decryptButton">éªŒè¯å¯†ç </button>\n';
            html += '        </div>\n';
            html += '        \n';
            html += '        <div id="errorMessage" class="error">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ï¼</div>\n';
            html += '        <div id="processingMessage" class="processing-message">æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...</div>\n';
            html += '        \n';
            html += '        <div id="actionContainer" class="action-buttons" style="display: none;">\n';
            html += '            <button id="downloadButton" class="download-btn">ä¸‹è½½è§†é¢‘</button>\n';
            html += '            <button id="playButton" class="play-btn">æ’­æ”¾è§†é¢‘</button>\n';
            html += '        </div>\n';
            html += '        \n';
            html += '        <div id="videoContainer" class="video-container">\n';
            html += '            <video id="videoPlayer" controls playsinline></video>\n';
            html += '        </div>\n';
            html += '        \n';
            html += '        <div class="instructions">\n';
            html += '            <p>ğŸ” æ­¤è§†é¢‘å†…å®¹å·²ä½¿ç”¨åŠ å¯†æŠ€æœ¯è¿›è¡Œä¿æŠ¤</p>\n';
            html += '            <p>ğŸ“ æ–‡ä»¶å¤§å°: ' + Math.round(fileSize/(1024*1024)) + 'MB</p>\n';
            html += '            <p>ğŸ“± æ”¯æŒç”µè„‘å’Œç§»åŠ¨è®¾å¤‡æ’­æ”¾</p>\n';
            html += '        </div>\n\n';
            html += '        <div class="footer">\n';
            html += '            <p>å®‰å…¨è§†é¢‘æ’­æ”¾ç³»ç»Ÿ</p>\n';
            html += '        </div>\n';
            html += '    </div>\n\n';
            html += '    <script>\n';
            html += '        // åŠ å¯†çš„è§†é¢‘æ•°æ®ï¼ˆBase64ç¼–ç ï¼‰\n';
            html += '        const encryptedVideoBase64 = "' + videoB64 + '";\n';
            html += '        const correctPasswordChecksum = "' + passwordChecksum + '";\n';
            html += '        const videoName = "' + videoName + '";\n';
            html += '        const totalFileSize = ' + fileSize + ';\n';
            html += '        \n';
            html += '        // å…¨å±€å˜é‡\n';
            html += '        let decryptedVideoData = null;\n';
            html += '        let isProcessing = false;\n';
            html += '        \n';
            html += '        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–\n';
            html += '        document.addEventListener("DOMContentLoaded", function() {\n';
            html += '            // å¼€å§‹åŠ è½½è¿›åº¦\n';
            html += '            simulateLoadingProgress();\n';
            html += '            \n';
            html += '            // æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶\n';
            html += '            document.getElementById("decryptButton").addEventListener("click", validatePassword);\n';
            html += '            document.getElementById("downloadButton").addEventListener("click", downloadVideo);\n';
            html += '            document.getElementById("playButton").addEventListener("click", playVideo);\n';
            html += '            \n';
            html += '            // æ”¯æŒæŒ‰å›è½¦é”®æäº¤å¯†ç \n';
            html += '            document.getElementById("passwordInput").addEventListener("keypress", function(e) {\n';
            html += '                if (e.key === "Enter") {\n';
            html += '                    validatePassword();\n';
            html += '                }\n';
            html += '            });\n';
            html += '        });\n';
            html += '        \n';
            html += '        // æ¨¡æ‹ŸåŠ è½½è¿›åº¦\n';
            html += '        function simulateLoadingProgress() {\n';
            html += '            const progressBar = document.getElementById("loadingProgressBar");\n';
            html += '            const loadingText = document.getElementById("loadingText");\n';
            html += '            const loadingDetails = document.getElementById("loadingDetails");\n';
            html += '            const loadingScreen = document.getElementById("loadingScreen");\n';
            html += '            const mainContainer = document.getElementById("mainContainer");\n';
            html += '            \n';
            html += '            let progress = 0;\n';
            html += '            const totalSteps = 100;\n';
            html += '            const fileSizeMB = Math.round(totalFileSize / (1024 * 1024));\n';
            html += '            \n';
            html += '            const interval = setInterval(function() {\n';
            html += '                progress += 1;\n';
            html += '                if (progress <= 85) {\n';
            html += '                    // å‰æœŸå¿«é€ŸåŠ è½½\n';
            html += '                    progressBar.style.width = progress + "%";\n';
            html += '                    loadingDetails.textContent = progress + "% - åŠ è½½åŸºç¡€èµ„æº";\n';
            html += '                } else if (progress <= 95) {\n';
            html += '                    // ä¸­æœŸä¸­ç­‰é€Ÿåº¦\n';
            html += '                    progress += 0.5;\n';
            html += '                    progressBar.style.width = progress + "%";\n';
            html += '                    loadingDetails.textContent = progress + "% - å¤„ç†è§†é¢‘æ•°æ®";\n';
            html += '                } else {\n';
            html += '                    // åæœŸæ…¢é€Ÿå®Œæˆ\n';
            html += '                    progress += 0.2;\n';
            html += '                    progressBar.style.width = progress + "%";\n';
            html += '                    loadingDetails.textContent = progress + "% - æœ€ç»ˆä¼˜åŒ–";\n';
            html += '                }\n';
            html += '                \n';
            html += '                if (progress >= 100) {\n';
            html += '                    clearInterval(interval);\n';
            html += '                    progressBar.style.width = "100%";\n';
            html += '                    loadingText.textContent = "åŠ è½½å®Œæˆï¼";\n';
            html += '                    loadingDetails.textContent = "100% - å‡†å¤‡å°±ç»ª";\n';
            html += '                    \n';
            html += '                    // å»¶è¿Ÿæ˜¾ç¤ºä¸»ç•Œé¢\n';
            html += '                    setTimeout(function() {\n';
            html += '                        loadingScreen.style.display = "none";\n';
            html += '                        mainContainer.style.display = "block";\n';
            html += '                        \n';
            html += '                        // è‡ªåŠ¨èšç„¦åˆ°å¯†ç è¾“å…¥æ¡†\n';
            html += '                        document.getElementById("passwordInput").focus();\n';
            html += '                    }, 500);\n';
            html += '                }\n';
            html += '            }, 50);\n';
            html += '        }\n';
            html += '        \n';
            html += '        // ç®€å•çš„æ ¡éªŒå’Œå‡½æ•°\n';
            html += '        function simpleChecksum(password) {\n';
            html += '            let checksum = 0;\n';
            html += '            for (let i = 0; i < password.length; i++) {\n';
            html += '                checksum = (checksum + password.charCodeAt(i)) % 10000;\n';
            html += '            }\n';
            html += '            return checksum.toString().padStart(4, "0");\n';
            html += '        }\n';
            html += '        \n';
            html += '        function validatePassword() {\n';
            html += '            const password = document.getElementById("passwordInput").value;\n';
            html += '            const errorMessage = document.getElementById("errorMessage");\n';
            html += '            const actionContainer = document.getElementById("actionContainer");\n';
            html += '            const processingMessage = document.getElementById("processingMessage");\n';
            html += '            \n';
            html += '            if (isProcessing) return;\n';
            html += '            \n';
            html += '            // éªŒè¯å¯†ç \n';
            html += '            if (!password) {\n';
            html += '                showError("è¯·è¾“å…¥å¯†ç ï¼");\n';
            html += '                return;\n';
            html += '            }\n';
            html += '            \n';
            html += '            // è®¡ç®—è¾“å…¥å¯†ç çš„æ ¡éªŒå’Œ\n';
            html += '            const inputChecksum = simpleChecksum(password);\n';
            html += '            if (inputChecksum !== correctPasswordChecksum) {\n';
            html += '                showError("å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ï¼");\n';
            html += '                return;\n';
            html += '            }\n';
            html += '            \n';
            html += '            // å¯†ç æ­£ç¡®ï¼Œæ˜¾ç¤ºæ“ä½œæŒ‰é’®\n';
            html += '            errorMessage.style.display = "none";\n';
            html += '            actionContainer.style.display = "flex";\n';
            html += '        }\n';
            html += '        \n';
            html += '        async function downloadVideo() {\n';
            html += '            if (isProcessing) return;\n';
            html += '            isProcessing = true;\n';
            html += '            \n';
            html += '            const password = document.getElementById("passwordInput").value;\n';
            html += '            const processingMessage = document.getElementById("processingMessage");\n';
            html += '            const actionContainer = document.getElementById("actionContainer");\n';
            html += '            \n';
            html += '            // æ˜¾ç¤ºå¤„ç†æ¶ˆæ¯ï¼Œéšè—æ“ä½œæŒ‰é’®\n';
            html += '            actionContainer.style.display = "none";\n';
            html += '            processingMessage.style.display = "block";\n';
            html += '            processingMessage.textContent = "æ­£åœ¨è§£å¯†å¹¶å‡†å¤‡ä¸‹è½½ï¼Œè¯·ç¨å€™...";\n';
            html += '            \n';
            html += '            try {\n';
            html += '                // è§£ç Base64æ•°æ®\n';
            html += '                const encryptedData = base64ToUint8Array(encryptedVideoBase64);\n';
            html += '                \n';
            html += '                // è§£å¯†æ•°æ®\n';
            html += '                decryptedVideoData = xorDecrypt(encryptedData, password);\n';
            html += '                \n';
            html += '                // åˆ›å»ºBlobå¯¹è±¡\n';
            html += '                const videoBlob = new Blob([decryptedVideoData], { type: "video/mp4" });\n';
            html += '                const videoUrl = URL.createObjectURL(videoBlob);\n';
            html += '                \n';
            html += '                // åˆ›å»ºä¸‹è½½é“¾æ¥\n';
            html += '                const a = document.createElement("a");\n';
            html += '                a.href = videoUrl;\n';
            html += '                a.download = videoName;\n';
            html += '                document.body.appendChild(a);\n';
            html += '                a.click();\n';
            html += '                \n';
            html += '                // æ¸…ç†\n';
            html += '                setTimeout(function() {\n';
            html += '                    document.body.removeChild(a);\n';
            html += '                    URL.revokeObjectURL(videoUrl);\n';
            html += '                    processingMessage.style.display = "none";\n';
            html += '                    actionContainer.style.display = "flex";\n';
            html += '                    isProcessing = false;\n';
            html += '                }, 100);\n';
            html += '                \n';
            html += '            } catch (error) {\n';
            html += '                processingMessage.style.display = "none";\n';
            html += '                actionContainer.style.display = "flex";\n';
            html += '                showError("ä¸‹è½½å¤±è´¥ï¼š" + error.message);\n';
            html += '                isProcessing = false;\n';
            html += '            }\n';
            html += '        }\n';
            html += '        \n';
            html += '        async function playVideo() {\n';
            html += '            if (isProcessing) return;\n';
            html += '            isProcessing = true;\n';
            html += '            \n';
            html += '            const password = document.getElementById("passwordInput").value;\n';
            html += '            const videoContainer = document.getElementById("videoContainer");\n';
            html += '            const processingMessage = document.getElementById("processingMessage");\n';
            html += '            const actionContainer = document.getElementById("actionContainer");\n';
            html += '            \n';
            html += '            // æ˜¾ç¤ºå¤„ç†æ¶ˆæ¯ï¼Œéšè—æ“ä½œæŒ‰é’®\n';
            html += '            actionContainer.style.display = "none";\n';
            html += '            processingMessage.style.display = "block";\n';
            html += '            processingMessage.textContent = "æ­£åœ¨è§£å¯†å¹¶å‡†å¤‡æ’­æ”¾ï¼Œè¯·ç¨å€™...";\n';
            html += '            \n';
            html += '            try {\n';
            html += '                // å¦‚æœå°šæœªè§£å¯†ï¼Œå…ˆè§£å¯†è§†é¢‘\n';
            html += '                if (!decryptedVideoData) {\n';
            html += '                    const encryptedData = base64ToUint8Array(encryptedVideoBase64);\n';
            html += '                    decryptedVideoData = xorDecrypt(encryptedData, password);\n';
            html += '                }\n';
            html += '                \n';
            html += '                // åˆ›å»ºBlobå¹¶è®¾ç½®è§†é¢‘æº\n';
            html += '                const videoBlob = new Blob([decryptedVideoData], { type: "video/mp4" });\n';
            html += '                const videoUrl = URL.createObjectURL(videoBlob);\n';
            html += '                \n';
            html += '                const videoPlayer = document.getElementById("videoPlayer");\n';
            html += '                videoPlayer.src = videoUrl;\n';
            html += '                videoContainer.style.display = "block";\n';
            html += '                processingMessage.style.display = "none";\n';
            html += '                actionContainer.style.display = "flex";\n';
            html += '                \n';
            html += '                // æ»šåŠ¨åˆ°è§†é¢‘ä½ç½®\n';
            html += '                videoContainer.scrollIntoView({ behavior: "smooth" });\n';
            html += '                \n';
            html += '                isProcessing = false;\n';
            html += '                \n';
            html += '            } catch (error) {\n';
            html += '                processingMessage.style.display = "none";\n';
            html += '                actionContainer.style.display = "flex";\n';
            html += '                showError("æ’­æ”¾å¤±è´¥ï¼š" + error.message);\n';
            html += '                isProcessing = false;\n';
            html += '            }\n';
            html += '        }\n';
            html += '        \n';
            html += '        function showError(message) {\n';
            html += '            const errorMessage = document.getElementById("errorMessage");\n';
            html += '            errorMessage.textContent = message;\n';
            html += '            errorMessage.style.display = "block";\n';
            html += '        }\n';
            html += '        \n';
            html += '        // Base64è½¬Uint8Array\n';
            html += '        function base64ToUint8Array(base64) {\n';
            html += '            const binaryString = atob(base64);\n';
            html += '            const len = binaryString.length;\n';
            html += '            const bytes = new Uint8Array(len);\n';
            html += '            for (let i = 0; i < len; i++) {\n';
            html += '                bytes[i] = binaryString.charCodeAt(i);\n';
            html += '            }\n';
            html += '            return bytes;\n';
            html += '        }\n';
            html += '        \n';
            html += '        // XORè§£å¯†å‡½æ•°\n';
            html += '        function xorDecrypt(data, key) {\n';
            html += '            const keyBytes = new TextEncoder().encode(key);\n';
            html += '            const result = new Uint8Array(data.length);\n';
            html += '            \n';
            html += '            for (let i = 0; i < data.length; i++) {\n';
            html += '                result[i] = data[i] ^ keyBytes[i % keyBytes.length];\n';
            html += '            }\n';
            html += '            \n';
            html += '            return result;\n';
            html += '        }\n';
            html += '    <\/script>\n';
            html += '</body>\n';
            html += '</html>';
            
            return html;
        }
        
        // ä¸‹è½½åŠ å¯†çš„HTMLæ–‡ä»¶
        function downloadEncryptedHtml() {
            if (!encryptedHtmlContent) return;
            
            const blob = new Blob([encryptedHtmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'encrypted_video_player.html';
            document.body.appendChild(a);
            a.click();
            
            // æ¸…ç†
            setTimeout(function() {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // é¢„è§ˆåŠ å¯†çš„HTMLæ–‡ä»¶
        function previewEncryptedHtml() {
            if (!encryptedHtmlContent) return;
            
            // ä½¿ç”¨Blob URLåˆ›å»ºé¢„è§ˆ
            const blob = new Blob([encryptedHtmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            previewFrame.src = url;
            previewContainer.style.display = 'block';
            
            // æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
            previewContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ‹–æ”¾åŠŸèƒ½
        const fileUploadLabel = document.querySelector('.file-upload label');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(function(eventName) {
            fileUploadLabel.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(function(eventName) {
            fileUploadLabel.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(function(eventName) {
            fileUploadLabel.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight(e) {
            fileUploadLabel.style.background = 'rgba(255, 255, 255, 0.25)';
            fileUploadLabel.style.borderColor = 'rgba(255, 255, 255, 0.5)';
        }
        
        function unhighlight(e) {
            fileUploadLabel.style.background = 'rgba(255, 255, 255, 0.15)';
            fileUploadLabel.style.borderColor = 'rgba(255, 255, 255, 0.3)';
        }
        
        fileUploadLabel.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                videoFileInput.files = files;
                handleFileSelect({ target: { files: files } });
            }
        }
    </script>
</body>
</html>